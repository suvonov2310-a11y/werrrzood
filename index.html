<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHASHKA ELITE ONLINE</title>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --main: #00d2ff; --bg: #050a10; --glass: rgba(255,255,255,0.05); }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; }
        
        /* Kirish ekrani */
        #auth-screen { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: flex; align-items: center; justify-content: center; }
        .auth-box { background: var(--glass); padding: 40px; border-radius: 20px; border: 1px solid var(--main); text-align: center; }
        
        /* Profil va Lobi */
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        .profile-card { background: linear-gradient(45deg, #1a2a3a, #050a10); padding: 20px; border-radius: 15px; border-left: 5px solid var(--main); margin-bottom: 20px; }
        .stats { display: flex; gap: 20px; margin-top: 10px; font-weight: bold; }
        
        /* Onlayn o'yinchilar ro'yxati */
        .online-list { background: var(--glass); border-radius: 15px; padding: 15px; height: 300px; overflow-y: auto; }
        .user-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        
        /* O'yin maydoni va Chat */
        #game-area { display: none; grid-template-columns: 1fr 300px; gap: 20px; }
        #board { width: 480px; height: 480px; display: grid; grid-template: repeat(8, 1fr) / repeat(8, 1fr); border: 10px solid #222; }
        .cell { display: flex; align-items: center; justify-content: center; }
        .dark { background: #1a1a1a; } .light { background: #e0e0e0; }
        .piece { width: 80%; height: 80%; border-radius: 50%; cursor: pointer; }
        .red { background: #ff4b2b; box-shadow: 0 4px #900; }
        .white { background: #fff; box-shadow: 0 4px #999; }
        
        /* Chat dizayni */
        .chat-box { background: #111; border-radius: 10px; display: flex; flex-direction: column; height: 480px; }
        #messages { flex: 1; padding: 10px; overflow-y: auto; font-size: 14px; }
        #chat-input { padding: 10px; background: #222; border: none; color: white; }
        
        .btn { padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; }
        .btn-main { background: var(--main); color: #000; }
        .btn-bot { background: #ffd700; color: #000; margin-top: 20px; width: 100%; }
    </style>
</head>
<body>

<div id="auth-screen">
    <div class="auth-box">
        <h1>ONLAYN SHASHKA</h1>
        <input type="text" id="nick" placeholder="Ismingizni kiriting..." style="padding:15px; width:250px; border-radius:10px; border:none; margin-bottom:20px;">
        <br>
        <button class="btn btn-main" onclick="startApp()">KIRISH</button>
    </div>
</div>

<div class="container" id="lobby">
    <div class="profile-card">
        <h2 id="my-name">Foydalanuvchi</h2>
        <div class="stats">
            <span>üèÜ Ball: <span id="my-xp">500</span></span>
            <span style="color:#2ecc71">W: <span id="my-wins">0</span></span>
            <span style="color:#e74c3c">L: <span id="my-losses">0</span></span>
        </div>
    </div>

    <h3><i class="fas fa-users"></i> Onlayn o'yinchilar</h3>
    <div class="online-list" id="user-list"></div>

    <button class="btn btn-bot" onclick="showBotOptions()">ü§ñ BOT BILAN O'YNASH</button>
</div>

<div class="container" id="game-area">
    <div id="board"></div>
    <div class="chat-box">
        <div style="padding:10px; border-bottom:1px solid #333">Chat</div>
        <div id="messages"></div>
        <input type="text" id="chat-input" placeholder="Xabar yozing..." onkeypress="sendChat(event)">
    </div>
</div>

<script>
    const socket = io();
    let myData = { xp: 500, wins: 0, losses: 0 };
    let currentRoom = "";

    function startApp() {
        const name = document.getElementById('nick').value;
        if(name.length < 2) return alert("Ism kiriting!");
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('my-name').innerText = name;
        socket.emit('login', { name });
    }

    socket.on('update-users', (users) => {
        const list = document.getElementById('user-list');
        list.innerHTML = "";
        users.forEach(user => {
            if(user.id !== socket.id) {
                list.innerHTML += `
                    <div class="user-item">
                        <span>${user.name} (${user.xp} ball)</span>
                        <button class="btn btn-main" onclick="invite('${user.id}')">Taklif qilish</button>
                    </div>`;
            } else {
                document.getElementById('my-xp').innerText = user.xp;
                document.getElementById('my-wins').innerText = user.wins;
                document.getElementById('my-losses').innerText = user.losses;
            }
        });
    });

    function invite(id) {
        socket.emit('send-invite', { toId: id });
        alert("Taklif yuborildi, kutilmoqda...");
    }

    socket.on('receive-invite', (data) => {
        if(confirm(data.fromName + "dan taklif tushdi. Qabul qilasizmi?")) {
            socket.emit('accept-invite', { fromId: data.fromId });
        }
    });

    socket.on('start-game', (data) => {
        currentRoom = data.roomId;
        document.getElementById('lobby').style.display = 'none';
        document.getElementById('game-area').style.display = 'grid';
        createBoard();
    });

    function sendChat(e) {
        if(e.key === 'Enter') {
            const text = e.target.value;
            socket.emit('send-msg', { roomId: currentRoom, text });
            e.target.value = "";
        }
    }

    socket.on('get-msg', (data) => {
        const msgDiv = document.getElementById('messages');
        msgDiv.innerHTML += `<div><b>${data.name}:</b> ${data.text}</div>`;
        msgDiv.scrollTop = msgDiv.scrollHeight;
    });

    function createBoard() {
        const boardDiv = document.getElementById('board');
        boardDiv.innerHTML = "";
        for(let i=0; i<64; i++) {
            const row = Math.floor(i/8);
            const col = i%8;
            const cell = document.createElement('div');
            cell.className = `cell ${(row+col)%2===0 ? 'light' : 'dark'}`;
            // Shashka toshlarini joylash...
            if((row+col)%2!==0 && row < 3) cell.innerHTML = '<div class="piece white"></div>';
            if((row+col)%2!==0 && row > 4) cell.innerHTML = '<div class="piece red"></div>';
            boardDiv.appendChild(cell);
        }
    }
</script>
</body>
</html>